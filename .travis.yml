language: r
cache: packages
r: release

env:
    - BIODB_OFFLINE=true

before_install:
    - sudo apt-get install -y libmagick++-dev
      #    - Rscript -e 'install.packages(c("remotes"));if (!all(c("remotes") %in% installed.packages())) { q(status = 1, save = "no")}'
      #    - Rscript -e 'deps <- remotes::dev_package_deps(dependencies = NA);remotes::install_deps(dependencies = TRUE);if (!all(deps$package %in% installed.packages())) { message("missing: ", paste(setdiff(deps$package, installed.packages()), collapse=", ")); q(status = 1, save = "no")}'

notifications:
    email:
        recipients:
            - pierrick.roger@cea.fr

script:
    - make build
      #    - make check # without vignettes
    - make full.check || (cat /home/travis/build/pkrog/biodb/biodb.Rcheck/tests/testthat.Rout.fail && false)

branches:
    only:
        - master
