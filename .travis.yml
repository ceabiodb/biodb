language: r
r: release
#cache:
#    packages: true
    #    directories:
    #        - $BIODB_CACHE_DIRECTORY

#r:
#    - oldrel
#    - release
      #    - devel

before_install:
    - sudo apt-get install -y libmagick++-dev
    - Rscript -e 'install.packages(c("remotes"));if (!all(c("remotes") %in% installed.packages())) { q(status = 1, save = "no")}'
    - Rscript -e 'deps <- remotes::dev_package_deps(dependencies = NA);remotes::install_deps(dependencies = TRUE);if (!all(deps$package %in% installed.packages())) { message("missing: ", paste(setdiff(deps$package, installed.packages()), collapse=", ")); q(status = 1, save = "no")}'

# XXX To be removed later, when R language is fixed on Travis-CI
#before_install: R -e 'source("https://install-github.me/r-lib/remotes")'

notifications:
 email:
  recipients:
   - pierrick.roger@cea.fr

#env:
#    - CHECK=yes
#    - TESTTHAT_REPORTER=summary
#    - MODE=offline TESTTHAT_REPORTER=summary
#    - DBS=hmdb.metabolites MODE=online TESTTHAT_REPORTER=summary
#    - DBS=massbank MODE=online TESTTHAT_REPORTER=summary
#    - DBS=peakforest.mass MODE=online TESTTHAT_REPORTER=summary
#    - EXCLUDE_DBS=hmdb.metabolites,massbank,peakforest.mass MODE=online TESTTHAT_REPORTER=summary

     #branches:
     #  only:
     #    - master
     #    - develop
      #    - /^.*_merging/
      #    - /^release[/].*$/
      #    - /^testing[/]travis-.*$/

script:
    - make build
#    - ./travis-tests


      #after_script:
    #    - if [ -f biodb.Rcheck/tests/testthat.Rout.fail ] ; then cat biodb.Rcheck/tests/testthat.Rout.fail ; fi
