language: r
cache: packages
r: release

env:
    - BIODB_USERAGENT="biodb.test ; pierrick.roger@cea.fr"

notifications:
    email:
        recipients:
            - pierrick.roger@cea.fr

before_install:
    - R -e 'install.packages("BiocManager");BiocManager::install("BiocCheck")'
    - R --slave --no-restore RHOME
    - ls -lh ~
    - ls -lh ~/R
    - ls -lh ~/R/Library
    - ls -lh ~/R/Library/BiocCheck
    - ls -lh ~/R/Library/BiocCheck/script
    - ls /opt
    - ls -lh /opt/R/4.0.2/lib/R/
    - ls -lh /opt/R/4.0.2/lib/R/bin
    - ls -lh /opt/R/4.0.2/lib/R/library
    - echo $PATH
    - PATH="$PATH:~/R/Library/BiocCheck/script/"
    - echo $PATH
      #    - cp ~/R/Library/BiocCheck/script/BiocCheck /opt/R/4.0.2/lib/R/bin/

script:
    - PATH="$PATH:~/R/Library/BiocCheck/script/"
    - make build
    - make full.check || (cat /home/travis/build/pkrog/biodb/biodb.Rcheck/tests/testthat.Rout.fail && false)
    - make bioc.check
