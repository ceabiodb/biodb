---
title: "*biodb*: Initializing biodb"
author: "Pierrick Roger"
date: "`r doc_date()`"
package: "`r pkg_ver('biodb')`"
abstract: |
  How to start with biodb package.
vignette: |
  %\VignetteIndexEntry{Initializing biodb}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: false
  BiocStyle::pdf_document: default
---

# Introduction

First of all, before using *biodb*, you need to create an instance of the main class `Biodb`. This is done by calling the constructor of the class through the `new()` method. The OOP (Object Oriented Programming) system used in the *biodb* package is the **R5** system also called **Reference Classes**. In this system, the created objects are not copied, but their reference are copied. This means than when you pass an instance to a function, that function is able to modify the instance.

To create an instance of the `Biodb` class, call the constructor method:
```{r}
mybiodb <- biodb::Biodb()
```
This is will create a `Biodb` instance and put its reference into the `mybiodb` variable. Calling `new()` without any argument configures the instance with the default values.

# Observers

By default, the `Biodb` instance will be configured with 3 observers:
 * `BiodbErrorReporter`, which is in charge of raising an error when an `error` message is sent.
 * `BiodbWarningReporter`, which is in charge of raising a warning when an `warning` message is sent.
 * `BiodbInfoReporter`, which is in charge of logging `info` messages to the console.

`BiodbInfoReporter` uses a level indicator to display messages. By default it is set to 1:
```{r}
mybiodb$getConfig()$get('msg.info.lvl')
```
If you wish to stop the info messages, set the desired level to 0:
```{r}
mybiodb$getConfig()$set('msg.info.lvl', 0)
```
On the other hand, if you wish to see more messages, increase the desired level:
```{r}
mybiodb$getConfig()$set('msg.info.lvl', 2)
```

## Lofginf into a file

To log into a file, use the `BiodbLogger` class. Here is the setting of a new logger for logging messages into a file:
```{r}
mybiodb$addObservers(biodb::BiodbLogger$new(file = 'mybiodb.log'))
```

If you wish to see all messages, make sure to increase the desired levels for each message category:
```{r}
mybiodb$getConfig()$set('msg.info.lvl', 2)
mybiodb$getConfig()$set('msg.caution.lvl', 2)
mybiodb$getConfig()$set('msg.debug.lvl', 2)
```

## Defining your own observers

If you wish, you can also define your own observers that inherit from the `BiodbObserver` class, and set them using the `addObservers()` method. 

## Getting a list of current observers

Here is how to obtain a list of all observers currently defined:
```{r}
mybiodb$getObservers()
```

# The singleton classes

Several singleton classes are defined in *biodb*. Their instances are all accessible from the `Biodb` instance you've created.

To get the factory instance:
```{r}
factory <- mybiodb$getFactory()
```

To get the configuration instance:
```{r}
config <- mybiodb$getConfig()
```

To get the cache system instance:
```{r}
cache <- mybiodb$getCache()
```

To get the database information instance:
```{r}
dbsinfo <- mybiodb$getDbsInfo()
```

To get the entry fields instance:
```{r}
entry.fields <- mybiodb$getEntryFields()
```

# Closing biodb instance

Do not forget to terminate your biodb instance once you are done with it:
```{r}
mybiodb$terminate()
```
