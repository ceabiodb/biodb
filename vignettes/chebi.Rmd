---
title: "*biodb*: Using ChEBI connector"
author: "Pierrick Roger"
date: "`r doc_date()`"
package: "`r pkg_ver('biodb')`"
abstract: |
  How to use the ChEBI connector and its methods.
vignette: |
  %\VignetteIndexEntry{Using ChEBI connector}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: false
  BiocStyle::pdf_document: default
---

# Introduction

Through the example of the ChEBI database, we are going to see how to access a database to access its entries.

First we instantiate the package:
```{r}
mybiodb <- biodb::Biodb$new()
```

Then we create a connector to ChEBI:
```{r}
chebi <- mybiodb$getFactory()$createConn('chebi')
```

# Requesting entries

Using accession numbers, we request entries from ChEBI:
```{r}
entries <- chebi$getEntry(c('2528', '17053', '15440'))
```

# Get entry fields

Getting the values of entry fields are done using `getFieldValue()` method.
Here we retrieve the SMILES fields for all ChEBI entries obtained previously:
```{r}
vapply(entries, function(e) e$getFieldValue('smiles'), FUN.VALUE = '')
```

# Get data frame

We can convert an entry into a data frame:
```{r}
entries[[1]]$getFieldsAsDataFrame()
```

Building a data frame for a list of entries is also possible:
```{r}
mybiodb$entriesToDataframe(entries, fields = c('accession', 'formula', 'molecular.mass', 'inchikey', 'kegg.compound.id'))
```

# Search by name and mass

Searching by name and/or mass is done through the `searchCompound()`.

Searching by name:
```{r}
chebi$searchCompound(name = 'aspartic', max.results = 3)
```

Searching by mass:
```{r}
chebi$searchCompound(mass = 133, mass.field = 'molecular.mass', mass.tol = 0.3, max.results = 3)
```

Searching by name and mass:
```{r}
ids <- chebi$searchCompound(name = 'aspartic', mass = 133, mass.field = 'molecular.mass', mass.tol = 0.3, max.results = 3)
```
Display results in data frame:
```{r}
mybiodb$entriesToDataframe(chebi$getEntry(ids), fields = c('accession', 'molecular.mass', 'name'))
```

# Convert CAS IDs

Converting CAS IDs to ChEBI IDs:
```{r}
chebi$convCasToChebi(c('87605-72-9', '51-41-2'))
```

If more than one ChEBI ID is found for a CAS ID, then a list of character vectors is returned:
```{r}
chebi$convCasToChebi('14215-68-0')
```
This behaviour can be made the default one by setting `simplify` parameter to `FALSE`.

# Convert InChI

The method is similar to `convCasToChebi()`.

Converting InChI to ChEBI IDs:
```{r}
chebi$convInchiToChebi('InChI=1S/C8H11NO3/c9-4-8(12)5-1-2-6(10)7(11)3-5/h1-3,8,10-12H,4,9H2/t8-/m0/s1')
```

You can also use an InChI key:
```{r}
chebi$convInchiToChebi('MBDOYVRWFFCFHM-SNAWJCMRSA-N')
```

# Closing biodb instance

Do not forget to terminate your biodb instance once you are done with it:
```{r}
mybiodb$terminate()
```
