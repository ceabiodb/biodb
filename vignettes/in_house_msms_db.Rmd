---
title: "*biodb*: In-house MSMS database"
author: "Pierrick Roger"
date: "`r BiocStyle::doc_date()`"
package: "`r BiocStyle::pkg_ver('biodb')`"
abstract: |
  How to define an in-house MSMS database and run spectrum annotation on it.
vignette: |
  %\VignetteIndexEntry{In-house MSMS database}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: false
  BiocStyle::pdf_document: default
---

# Introduction

In this vignette, we will define an in-house MSMS database and try to match a spectrum on it.

```{r}
mybiodb <- biodb::Biodb$new()
```

# Defining the database

We create the connector to a CSV file database built with MS2 spectra extracted from Massbank:
```{r}
db.tsv <- system.file("extdata", "massbank_extract_msms.tsv", package='biodb')
conn <- mybiodb$getFactory()$createConn('mass.csv.file', url=db.tsv)
```

# Searching for entries

We can search for entries containing certain M/Z values with the following method:
```{r}
conn$searchMsEntries(mz.min = 115, mz.max = 115.1, max.results = 5)
```

It is also possible to call it with a tolerance:
```{r}
conn$searchMsEntries(mz = 115, mz.tol = 0.1, mz.tol.unit = 'plain', max.results = 5)
```

# Spectrum matching

The spectrum to search for must be defined inside a data frame:
```{r}
spectrum <- data.frame(mz = c(286.1456, 287.1488, 288.1514), rel.int = c(100, 45, 18))
```

Then we call the `msmsSearch()` method:
```{r}
conn$msmsSearch(spectrum, precursor.mz = 286.1438, mz.tol = 0.1, mz.tol.unit = 'plain', ms.mode = 'pos')
```

# Closing biodb instance

Do not forget to terminate your biodb instance once you are done with it:
```{r}
mybiodb$terminate()
```
